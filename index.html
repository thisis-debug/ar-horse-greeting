<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Horse on Marker</title>
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">

  <!-- カメラ映像に重ねる AR シーン -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false;"
  >

    <!-- 自作マーカー（marker.patt）を使う -->
    <a-marker type="pattern" url="marker.patt">

      <!-- 馬グループ全体（回転や移動のベース） -->
      <a-entity id="horse-root" position="0 0 0">

        <!-- 馬の体 -->
        <a-box position="0 0.25 0"
               depth="0.6" height="0.3" width="0.2"
               color="#8B4513"></a-box>

        <!-- 頭 -->
        <a-box position="0 0.35 0.35"
               depth="0.2" height="0.2" width="0.18"
               color="#8B4513"></a-box>

        <!-- 首 -->
        <a-box position="0 0.32 0.2"
               depth="0.2" height="0.25" width="0.12"
               color="#A0522D"></a-box>

        <!-- 足（4本） -->
        <a-box position="-0.07 0.05 -0.18"
               depth="0.1" height="0.1" width="0.06"
               color="#654321"></a-box>
        <a-box position=" 0.07 0.05 -0.18"
               depth="0.1" height="0.1" width="0.06"
               color="#654321"></a-box>
        <a-box position="-0.07 0.05  0.18"
               depth="0.1" height="0.1" width="0.06"
               color="#654321"></a-box>
        <a-box position=" 0.07 0.05  0.18"
               depth="0.1" height="0.1" width="0.06"
               color="#654321"></a-box>

        <!-- しっぽ -->
        <a-box position="0 0.3 -0.35"
               depth="0.15" height="0.05" width="0.05"
               color="#3B2F2F"></a-box>

      </a-entity>

    </a-marker>

    <!-- カメラ -->
    <a-entity camera></a-entity>

  </a-scene>

  <script>
    const horseRoot = document.getElementById("horse-root");

    // 馬をマーカーの上で円形に走らせる
    let angle = 0;

    function animateHorse() {
      angle += 0.03; // スピード

      const r = 0.6; // 半径（メートル相当）
      const x = Math.cos(angle) * r;
      const z = Math.sin(angle) * r;

      horseRoot.setAttribute("position", `${x} 0 ${z}`);

      // 進行方向を向かせる
      const yaw = -angle * 180 / Math.PI + 90;
      horseRoot.setAttribute("rotation", `0 ${yaw} 0`);

      requestAnimationFrame(animateHorse);
    }

    animateHorse();
  </script>

</body>
</html>